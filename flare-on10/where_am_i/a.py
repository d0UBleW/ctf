#!/usr/bin/env python3

# type: ignore

import ctypes
import sys

from capstone import *
from capstone.x86 import *

with open("./sc0.bin", "rb") as f:
    sc = f.read()


md = Cs(CS_ARCH_X86, CS_MODE_32)
md.detail = True

asm = {}

for (address, *i) in md.disasm_lite(sc, len(sc)):
    asm[address] = i

vtable = {
    0x4783c8: "SetSecurityDescriptorDacl",
    0x4783c4: "InitializeSecurityDescriptor",
    0x478370: "GetProcessHeap",
    0x478374: "OpenMutexA",
    0x478378: "CreateProcessA",
    0x47837c: "VirtualAllocEx",
    0x478380: "WriteProcessMemory",
    0x478384: "QueueUserAPC",
    0x478388: "ResumeThread",
    0x47838c: "GetSystemDefaultLangID",
    0x478390: "GetAtomNameA",
    0x4783a8: "PathFileExistsA",
    0x460000: "advapi32.RegSetValueA",
    0x460004: "advapi32.RegDeleteValueA",
    0x460008: "advapi32.RegSetValueExA",
    0x46000C: "advapi32.RegCreateKeyExA",
    0x460014: "advapi32.RegOpenKeyA",
    0x460018: "advapi32.RegEnumKeyA",
    0x46001C: "advapi32.RegDeleteKeyA",
    0x460020: "advapi32.GetFileSecurityA",
    0x460024: "advapi32.SetFileSecurityA",
    0x460028: "advapi32.RegOpenKeyExA",
    0x46002C: "advapi32.RegQueryValueExA",
    0x460030: "advapi32.RegCloseKey",
    0x460034: "advapi32.RegCreateKeyA",
    0x46003C: "comdlg32.GetFileTitleA",
    0x460044: "gdi32.EnumEnhMetaFile",
    0x460048: "gdi32.GetEnhMetaFileHeader",
    0x46004C: "gdi32.CloseEnhMetaFile",
    0x460050: "gdi32.CreateEnhMetaFileA",
    0x460054: "gdi32.PlayEnhMetaFileRecord",
    0x460058: "gdi32.Polyline",
    0x46005C: "gdi32.Polygon",
    0x460060: "gdi32.DPtoLP",
    0x460064: "gdi32.DeleteEnhMetaFile",
    0x460068: "gdi32.BitBlt",
    0x46006C: "gdi32.GetBkColor",
    0x460070: "gdi32.GetViewportExtEx",
    0x460074: "gdi32.GetWindowExtEx",
    0x460078: "gdi32.GetMapMode",
    0x46007C: "gdi32.CreateCompatibleBitmap",
    0x460080: "gdi32.LPtoDP",
    0x460084: "gdi32.CreateCompatibleDC",
    0x460088: "gdi32.PtVisible",
    0x46008C: "gdi32.RectVisible",
    0x460090: "gdi32.TextOutA",
    0x460094: "gdi32.ExtTextOutA",
    0x460098: "gdi32.Escape",
    0x46009C: "gdi32.SetMapMode",
    0x4600A0: "gdi32.GetClipBox",
    0x4600A4: "gdi32.ExcludeClipRect",
    0x4600A8: "gdi32.IntersectClipRect",
    0x4600AC: "gdi32.LineTo",
    0x4600B0: "gdi32.MoveToEx",
    0x4600B4: "gdi32.SetTextAlign",
    0x4600B8: "gdi32.DeleteObject",
    0x4600BC: "gdi32.SelectClipRgn",
    0x4600C0: "gdi32.CreateRectRgn",
    0x4600C4: "gdi32.GetObjectA",
    0x4600C8: "gdi32.GetStockObject",
    0x4600CC: "gdi32.GetEnhMetaFileBits",
    0x4600D0: "gdi32.GetDeviceCaps",
    0x4600D4: "gdi32.CreatePen",
    0x4600D8: "gdi32.CreateSolidBrush",
    0x4600DC: "gdi32.GetTextExtentPoint32A",
    0x4600E0: "gdi32.GetTextAlign",
    0x4600E4: "gdi32.GetTextMetricsA",
    0x4600E8: "gdi32.CloseMetaFile",
    0x4600EC: "gdi32.DeleteMetaFile",
    0x4600F0: "gdi32.GetCharWidthA",
    0x4600F4: "gdi32.CreateFontA",
    0x4600F8: "gdi32.StretchDIBits",
    0x4600FC: "gdi32.StartPage",
    0x460100: "gdi32.EndPage",
    0x460104: "gdi32.SetAbortProc",
    0x460108: "gdi32.AbortDoc",
    0x46010C: "gdi32.EndDoc",
    0x460110: "gdi32.CreateDCA",
    0x460114: "gdi32.GetViewportOrgEx",
    0x460118: "gdi32.Rectangle",
    0x46011C: "gdi32.PatBlt",
    0x460120: "gdi32.CreateFontIndirectA",
    0x460124: "gdi32.CreateRectRgnIndirect",
    0x460128: "gdi32.SetRectRgn",
    0x46012C: "gdi32.CombineRgn",
    0x460130: "gdi32.CopyMetaFileA",
    0x460134: "gdi32.GetTextColor",
    0x460138: "gdi32.GetRgnBox",
    0x46013C: "gdi32.CreateEllipticRgn",
    0x460140: "gdi32.Ellipse",
    0x460144: "gdi32.GetNearestColor",
    0x460148: "gdi32.GetBkMode",
    0x46014C: "gdi32.GetPolyFillMode",
    0x460150: "gdi32.GetROP2",
    0x460154: "gdi32.GetStretchBltMode",
    0x460158: "gdi32.GetTextFaceA",
    0x46015C: "gdi32.GetTextExtentPointA",
    0x460160: "gdi32.SetTextColor",
    0x460164: "gdi32.SetStretchBltMode",
    0x460168: "gdi32.SetROP2",
    0x46016C: "gdi32.SetPolyFillMode",
    0x460170: "gdi32.SetBkMode",
    0x460174: "gdi32.SetBkColor",
    0x460178: "gdi32.RestoreDC",
    0x46017C: "gdi32.SaveDC",
    0x460180: "gdi32.CreateBitmap",
    0x460184: "gdi32.CreatePatternBrush",
    0x460188: "gdi32.DeleteDC",
    0x46018C: "gdi32.ExtSelectClipRgn",
    0x460190: "gdi32.GetWindowOrgEx",
    0x460194: "gdi32.GetCurrentPositionEx",
    0x460198: "gdi32.ScaleWindowExtEx",
    0x46019C: "gdi32.SetWindowExtEx",
    0x4601A0: "gdi32.SetWindowOrgEx",
    0x4601A4: "gdi32.ScaleViewportExtEx",
    0x4601A8: "gdi32.SetViewportExtEx",
    0x4601AC: "gdi32.OffsetViewportOrgEx",
    0x4601B0: "gdi32.SetViewportOrgEx",
    0x4601B4: "gdi32.SelectObject",
    0x4601B8: "gdi32.StartDocA",
    0x4601BC: "gdi32.GetPixel",
    0x4601C4: "kernel32.GetModuleHandleW",
    0x4601C8: "ntdll.RtlInitializeCriticalSection",
    0x4601CC: "ntdll.RtlDeleteCriticalSection",
    0x4601D0: "ntdll.RtlLeaveCriticalSection",
    0x4601D4: "ntdll.RtlEnterCriticalSection",
    0x4601D8: "kernel32.GlobalFlags",
    0x4601DC: "kernel32.LocalAlloc",
    0x4601E0: "kernel32.TlsGetValue",
    0x4601E4: "kernel32.GlobalHandle",
    0x4601E8: "kernel32.TlsAlloc",
    0x4601EC: "kernel32.TlsSetValue",
    0x4601F0: "kernel32.CreateFileA",
    0x4601F4: "kernel32.TlsFree",
    0x4601F8: "kernel32.LocalFileTimeToFileTime",
    0x4601FC: "kernel32.SystemTimeToFileTime",
    0x460200: "kernel32.GetFileSizeEx",
    0x460204: "kernel32.GetCPInfo",
    0x460208: "kernel32.GetOEMCP",
    0x46020C: "kernel32.GetCurrentDirectoryA",
    0x460210: "kernel32.SetErrorMode",
    0x460214: "kernel32.RtlUnwind",
    0x460218: "kernel32.HeapFree",
    0x46021C: "ntdll.RtlAllocateHeap",
    0x460220: "kernel32.GetCommandLineA",
    0x460224: "kernel32.GetStartupInfoA",
    0x460228: "kernel32.RaiseException",
    0x46022C: "kernel32.Sleep",
    0x460230: "kernel32.ExitProcess",
    0x460234: "ntdll.RtlReAllocateHeap",
    0x460238: "kernel32.VirtualProtect",
    0x46023C: "kernel32.VirtualAlloc",
    0x460240: "kernel32.GetSystemInfo",
    0x460244: "kernel32.VirtualQuery",
    0x460248: "ntdll.RtlSizeHeap",
    0x46024C: "kernel32.TerminateProcess",
    0x460250: "kernel32.UnhandledExceptionFilter",
    0x460254: "kernel32.SetUnhandledExceptionFilter",
    0x460258: "kernel32.IsDebuggerPresent",
    0x46025C: "kernel32.HeapCreate",
    0x460260: "kernel32.VirtualFree",
    0x460264: "kernel32.GetStdHandle",
    0x460268: "kernel32.FreeEnvironmentStringsA",
    0x46026C: "kernel32.GetEnvironmentStrings",
    0x460270: "kernel32.FreeEnvironmentStringsW",
    0x460274: "kernel32.GetEnvironmentStringsW",
    0x460278: "kernel32.SetHandleCount",
    0x46027C: "kernel32.GetFileType",
    0x460280: "kernel32.QueryPerformanceCounter",
    0x460284: "kernel32.GetSystemTimeAsFileTime",
    0x460288: "kernel32.GetACP",
    0x46028C: "kernel32.IsValidCodePage",
    0x460290: "kernel32.InitializeCriticalSectionAndSpinCount",
    0x460294: "kernel32.GetTimeZoneInformation",
    0x460298: "kernel32.GetStringTypeA",
    0x46029C: "kernel32.GetStringTypeW",
    0x4602A0: "kernel32.GetConsoleCP",
    0x4602A4: "kernel32.GetConsoleMode",
    0x4602A8: "kernel32.LCMapStringA",
    0x4602AC: "kernel32.LCMapStringW",
    0x4602B0: "kernel32.SetStdHandle",
    0x4602B4: "kernel32.WriteConsoleA",
    0x4602B8: "kernel32.GetConsoleOutputCP",
    0x4602BC: "kernel32.WriteConsoleW",
    0x4602C0: "kernel32.CompareStringW",
    0x4602C4: "kernel32.SetEnvironmentVariableA",
    0x4602CC: "kernel32.GetVolumeInformationA",
    0x4602D0: "kernel32.FindFirstFileA",
    0x4602D4: "kernel32.FindClose",
    0x4602D8: "kernel32.GetCurrentProcess",
    0x4602DC: "kernel32.DuplicateHandle",
    0x4602E0: "kernel32.GetFileSize",
    0x4602E4: "kernel32.SetEndOfFile",
    0x4602E8: "kernel32.UnlockFile",
    0x4602EC: "kernel32.LockFile",
    0x4602F0: "kernel32.FlushFileBuffers",
    0x4602F4: "kernel32.SetFilePointer",
    0x4602F8: "kernel32.WriteFile",
    0x4602FC: "kernel32.ReadFile",
    0x460300: "kernel32.lstrcmpiA",
    0x460304: "kernel32.GetThreadLocale",
    0x460308: "kernel32.GetStringTypeA",
    0x46030C: "kernel32.DeleteFileA",
    0x460310: "kernel32.MoveFileA",
    0x460314: "kernel32.FileTimeToLocalFileTime",
    0x460318: "kernel32.FileTimeToSystemTime",
    0x46031C: "kernel32.GetModuleFileNameW",
    0x460320: "kernel32.CopyFileA",
    0x460324: "kernel32.FormatMessageA",
    0x460328: "kernel32.LocalFree",
    0x46032C: "kernel32.lstrlenW",
    0x460330: "kernel32.GetTickCount",
    0x460334: "kernel32.GetPrivateProfileStringA",
    0x460338: "kernel32.WritePrivateProfileStringA",
    0x46033C: "kernel32.GetPrivateProfileIntA",
    0x460340: "kernel32.CloseHandle",
    0x460344: "kernel32.GetCurrentThread",
    0x460348: "kernel32.ConvertDefaultLocale",
    0x46034C: "kernel32.EnumResourceLanguagesA",
    0x460350: "kernel32.GetLocaleInfoA",
    0x460354: "kernel32.InterlockedExchange",
    0x46035C: "kernel32.GlobalFindAtomA",
    0x460360: "kernel32.GlobalDeleteAtom",
    0x460364: "kernel32.FreeLibrary",
    0x460368: "kernel32.CompareStringA",
    0x46036C: "kernel32.lstrcmpW",
    0x460370: "kernel32.GetVersionExA",
    0x460374: "kernel32.FreeResource",
    0x460378: "kernel32.LoadLibraryA",
    0x46037C: "kernel32.GlobalGetAtomNameA",
    0x460380: "kernel32.GlobalAddAtomA",
    0x460384: "kernel32.MulDiv",
    0x460388: "kernel32.lstrcmpA",
    0x46038C: "kernel32.GlobalReAlloc",
    0x460390: "kernel32.GlobalSize",
    0x460394: "kernel32.GetCurrentProcessId",
    0x460398: "kernel32.GetModuleFileNameA",
    0x46039C: "kernel32.GetLastError",
    0x4603A0: "kernel32.SetLastError",
    0x4603A4: "kernel32.GetDiskFreeSpaceA",
    0x4603A8: "kernel32.GetFullPathNameA",
    0x4603AC: "kernel32.GetTempFileNameA",
    0x4603B0: "kernel32.GetFileTime",
    0x4603B4: "kernel32.SetFileTime",
    0x4603B8: "kernel32.lstrlen",
    0x4603BC: "kernel32.GetModuleHandleA",
    0x4603C0: "kernel32.GetProcAddress",
    0x4603C4: "kernel32.GetFileAttributesA",
    0x4603C8: "kernel32.InterlockedIncrement",
    0x4603CC: "kernel32.InterlockedDecrement",
    0x4603D0: "kernel32.WideCharToMultiByte",
    0x4603D4: "kernel32.MultiByteToWideChar",
    0x4603D8: "kernel32.FindResourceA",
    0x4603DC: "kernel32.LoadResource",
    0x4603E0: "kernel32.LockResource",
    0x4603E4: "kernel32.SizeofResource",
    0x4603E8: "kernel32.GlobalUnlock",
    0x4603EC: "kernel32.GlobalFree",
    0x4603F0: "kernel32.GlobalAlloc",
    0x4603F4: "kernel32.LocalReAlloc",
    0x4603F8: "kernel32.GlobalLock",
    0x460400: "oleacc.LresultFromObject",
    0x460404: "oleacc.CreateStdAccessibleObject",
    0x46040C: "oleaut32.SysStringLen",
    0x460410: "oleaut32.SysAllocStringByteLen",
    0x460414: "oleaut32.VariantInit",
    0x460418: "oleaut32.OleCreateFontIndirect",
    0x46041C: "oleaut32.VariantTimeToSystemTime",
    0x460420: "oleaut32.SystemTimeToVariantTime",
    0x460424: "oleaut32.SafeArrayDestroy",
    0x460428: "oleaut32.VariantChangeType",
    0x46042C: "oleaut32.VariantClear",
    0x460430: "oleaut32.SysAllocStringLen",
    0x460434: "oleaut32.SysAllocString",
    0x460438: "oleaut32.VariantCopy",
    0x46043C: "oleaut32.SysFreeString",
    0x460444: "shell32.ExtractIconA",
    0x460448: "shell32.DragQueryFile",
    0x46044C: "shell32.SHGetFileInfoA",
    0x460450: "shell32.DragFinish",
    0x460458: "shlwapi.PathFindFileNameA",
    0x46045C: "shlwapi.PathStripToRootA",
    0x460460: "shlwapi.PathIsUNCA",
    0x460464: "shlwapi.PathFindExtensionA",
    0x460468: "shlwapi.PathRemoveFileSpecW",
    0x460470: "user32.GetNextDlgTabItem",
    0x460474: "user32.CreateDialogIndirectParamA",
    0x460478: "user32.GetMenuStringA",
    0x46047C: "user32.InsertMenuA",
    0x460480: "user32.DestroyCursor",
    0x460484: "user32.LoadCursorA",
    0x460488: "user32.InflateRect",
    0x46048C: "user32.RemoveMenu",
    0x460490: "user32.CharUpperA",
    0x460494: "user32.GetSysColorBrush",
    0x460498: "user32.SetCapture",
    0x46049C: "user32.CreateMenu",
    0x4604A0: "user32.WindowFromPoint",
    0x4604A4: "user32.GetMenuItemInfoA",
    0x4604A8: "user32.SetTimer",
    0x4604AC: "user32.KillTimer",
    0x4604B0: "user32.GetDCEx",
    0x4604B4: "user32.LockWindowUpdate",
    0x4604B8: "user32.DestroyCursor",
    0x4604BC: "user32.CharNextA",
    0x4604C0: "user32.InvalidateRgn",
    0x4604C4: "user32.GetNextDlgGroupItem",
    0x4604C8: "user32.MessageBeep",
    0x4604CC: "user32.PostThreadMessageA",
    0x4604D0: "user32.DrawIcon",
    0x4604D4: "user32.SetWindowRgn",
    0x4604D8: "user32.UnregisterClassA",
    0x4604DC: "user32.AppendMenuA",
    0x4604E0: "user32.DeleteMenu",
    0x4604E4: "user32.MoveWindow",
    0x4604E8: "user32.SetWindowTextA",
    0x4604EC: "user32.IsDialogMessageA",
    0x4604F0: "user32.SetDlgItemTextA",
    0x4604F4: "user32.RegisterWindowMessageA",
    0x4604F8: "user32.SendDlgItemMessageA",
    0x4604FC: "user32.IsChild",
    0x460500: "user32.SetWindowsHookExA",
    0x460508: "user32.GetClassLongA",
    0x46050C: "user32.SetPropA",
    0x460510: "user32.GetPropA",
    0x460514: "user32.RemovePropA",
    0x460518: "user32.GetWindowTextLengthA",
    0x46051C: "user32.GetWindowTextA",
    0x460520: "user32.GetForegroundWindow",
    0x460524: "user32.DispatchMessageA",
    0x460528: "user32.BeginDeferWindowPos",
    0x46052C: "user32.EndDeferWindowPos",
    0x460530: "user32.GetTopWindow",
    0x460534: "user32.DestroyWindow",
    0x460538: "user32.GetMessageTime",
    0x460540: "user32.MapWindowPoints",
    0x460544: "user32.ScrollWindow",
    0x460548: "user32.TrackPopupMenu",
    0x46054C: "user32.SetScrollRange",
    0x460550: "user32.GetScrollRange",
    0x460554: "user32.SetScrollPos",
    0x460558: "user32.GetScrollPos",
    0x46055C: "user32.SetForegroundWindow",
    0x460560: "user32.ShowScrollBar",
    0x460564: "user32.CreateWindowExA",
    0x460568: "user32.GetClassInfoExA",
    0x46056C: "user32.RegisterClassA",
    0x460570: "user32.AdjustWindowRectEx",
    0x460574: "user32.EndDialog",
    0x460578: "user32.GetScrollInfo",
    0x46057C: "user32.SetScrollInfo",
    0x460580: "ntdll.NtdllDefWindowProc_A",
    0x460584: "user32.CallWindowProcA",
    0x460588: "user32.SystemParametersInfoA",
    0x46058C: "user32.GetWindowPlacement",
    0x460590: "user32.PtInRect",
    0x460594: "user32.GetWindowRect",
    0x460598: "user32.IsZoomed",
    0x46059C: "user32.GetSystemMetrics",
    0x4605A0: "user32.GetClassNameA",
    0x4605A4: "user32.UnpackDDElParam",
    0x4605A8: "user32.ReuseDDElParam",
    0x4605AC: "user32.LoadMenuA",
    0x4605B0: "user32.DestroyMenu",
    0x4605B4: "user32.WinHelpA",
    0x4605B8: "user32.SetWindowPos",
    0x4605BC: "user32.SetFocus",
    0x4605C0: "user32.EqualRect",
    0x4605C4: "user32.GetDlgItem",
    0x4605C8: "user32.SetWindowLongA",
    0x4605CC: "user32.GetDlgCtrlID",
    0x4605D0: "user32.GetKeyState",
    0x4605D4: "user32.LoadIconA",
    0x4605D8: "user32.SetCursor",
    0x4605DC: "user32.PeekMessageA",
    0x4605E4: "user32.ReleaseCapture",
    0x4605E8: "user32.LoadAcceleratorsA",
    0x4605EC: "user32.SetActiveWindow",
    0x4605F0: "user32.IsIconic",
    0x4605F4: "user32.InsertMenuItemA",
    0x4605F8: "user32.GetSubMenu",
    0x4605FC: "user32.GetMenuItemID",
    0x460600: "user32.GetMenuItemCount",
    0x460604: "user32.CreatePopupMenu",
    0x460608: "user32.GetClassInfoA",
    0x46060C: "user32.OffsetRect",
    0x460610: "user32.GetMenu",
    0x460614: "user32.BringWindowToTop",
    0x460618: "user32.SetMenu",
    0x46061C: "user32.GetDesktopWindow",
    0x460620: "user32.GetWindow",
    0x460624: "user32.ShowWindow",
    0x460628: "user32.TranslateAccelerator",
    0x46062C: "user32.GetTabbedTextExtentA",
    0x460630: "user32.GetSysColor",
    0x460634: "user32.EndPaint",
    0x460638: "user32.BeginPaint",
    0x46063C: "user32.UnhookWindowsHookEx",
    0x460640: "user32.SetRect",
    0x460644: "user32.UpdateWindow",
    0x460648: "user32.EnableWindow",
    0x46064C: "user32.GetClientRect",
    0x460650: "user32.GetWindowDC",
    0x460654: "user32.ReleaseDC",
    0x460658: "user32.ClientToScreen",
    0x46065C: "user32.ScreenToClient",
    0x460660: "user32.FillRect",
    0x460664: "user32.GetWindowThreadProcessId",
    0x460668: "user32.GetWindowLongA",
    0x46066C: "user32.GetLastActivePopup",
    0x460670: "user32.IsWindowEnabled",
    0x460674: "user32.MessageBoxA",
    0x460678: "user32.IsWindowVisible",
    0x46067C: "user32.IsWindow",
    0x460680: "user32.GetActiveWindow",
    0x460684: "user32.CopyAcceleratorTableA",
    0x460688: "user32.SendNotifyMessageA",
    0x46068C: "user32.PostMessageA",
    0x460690: "user32.IntersectRect",
    0x460694: "user32.RegisterWindowMessageA",
    0x460698: "user32.SetWindowContextHelpId",
    0x46069C: "user32.MapDialogRect",
    0x4606A0: "user32.ShowOwnedPopups",
    0x4606A4: "user32.GetMessageA",
    0x4606A8: "user32.GetDC",
    0x4606AC: "user32.InvalidateRect",
    0x4606B0: "user32.TabbedTextOutA",
    0x4606B4: "user32.DrawTextA",
    0x4606B8: "user32.DrawTextExA",
    0x4606BC: "user32.GrayStringA",
    0x4606C0: "user32.TranslateMessage",
    0x4606C4: "user32.GetCursorPos",
    0x4606C8: "user32.ValidateRect",
    0x4606CC: "user32.PostQuitMessage",
    0x4606D0: "user32.SetParent",
    0x4606D4: "user32.DeferWindowPos",
    0x4606D8: "user32.GetSystemMenu",
    0x4606E0: "user32.CheckMenuItem",
    0x4606E8: "user32.GetMenuState",
    0x4606EC: "user32.ModifyMenuA",
    0x4606F0: "user32.SendMessageA",
    0x4606F4: "user32.GetParent",
    0x4606F8: "user32.GetFocus",
    0x4606FC: "user32.LoadBitmapA",
    0x460700: "user32.GetMenuCheckMarkDimensions",
    0x460704: "user32.SetMenuItemBitmaps",
    0x460708: "user32.IsClipboardFormatAvailable",
    0x46070C: "user32.IsRectEmpty",
    0x460710: "user32.SetRectEmpty",
    0x460714: "user32.CopyRect",
    0x46071C: "winspool.ClosePrinter",
    0x460720: "winspool.GetJobA",
    0x460724: "winspool.OpenPrinterA",
    0x460728: "winspool.DocumentPropertiesA",
    0x460730: "ole32.OleIsCurrentClipboard",
    0x460734: "ole32.OleFlushClipboard",
    0x460738: "combase.CLSIDFromProgID",
    0x46073C: "combase.CLSIDFromString",
    0x460744: "combase.CoFreeUnusedLibraries",
    0x460748: "ole32.OleInitialize",
    0x46074C: "combase.CoTaskMemAlloc",
    0x460750: "ole32.OleRegGetUserType",
    0x460754: "ole32.ReadFmtUserTypeStg",
    0x460758: "ole32.ReadStorageProperties",
    0x46075C: "ole32.CreateBindCtx",
    0x460760: "ole32.SetConvertStg",
    0x460764: "ole32.WriteFmtUserTypeStg",
    0x460768: "ole32.WriteClassStg",
    0x46076C: "ole32.CoTreatAsClass",
    0x460770: "ole32.OleDuplicateData",
    0x460774: "combase.CoDisconnectObject",
    0x460778: "combase.CoGetClassObject",
    0x46077C: "combase.CoRevokeClassObject",
    0x460780: "ole32.CoRegisterMessageFilter",
    0x460784: "combase.CoUninitialize",
    0x46078C: "ole32.OleSetClipboard",
    0x460790: "ole32.OleTranslateAccelerator",
    0x460794: "ole32.IsAccelerator",
    0x460798: "ole32.OleCreateMenuDescriptor",
    0x46079C: "ole32.OleDestroyMenuDescriptor",
    0x4607A0: "ole32.CreateGenericComposite",
    0x4607A4: "ole32.CreateItemMoniker",
    0x4607A8: "ole32.OleGetIconOfClass",
    0x4607AC: "ole32.OleCreateLinkToFile",
    0x4607B0: "ole32.OleCreateFromFile",
    0x4607B4: "ole32.OleSetContainedObject",
    0x4607B8: "combase.StringFromCLSID",
    0x4607BC: "ole32.GetHGlobalFromILockBytes",
    0x4607C0: "ole32.StgOpenStorageOnILockBytes",
    0x4607C4: "ole32.OleLoad",
    0x4607C8: "ole32.OleCreate",
    0x4607CC: "ole32.OleCreateStaticFromData",
    0x4607D0: "ole32.OleGetClipboard",
    0x4607D4: "ole32.OleSetMenuDescriptor",
    0x4607D8: "combase.CoInitializeEx",
    0x4607DC: "ole32.StgCreateDocfile",
    0x4607E0: "combase.CoTaskMemFree",
    0x4607E4: "ole32.CreateFileMoniker",
    0x4607E8: "ole32.StgOpenStorage",
    0x4607EC: "ole32.StgIsStorageFile",
    0x4607F0: "ole32.OleCreateFromData",
    0x4607F4: "ole32.OleLockRunning",
    0x4607F8: "combase.CreateStreamOnHGlobal",
    0x4607FC: "ole32.OleSaveToStream",
    0x460800: "ole32.WriteClassStm",
    0x460804: "ole32.ReleaseStgMedium",
    0x460808: "ole32.OleSave",
    0x46080C: "ole32.CreateILockBytesOnHGlobal",
    0x460810: "ole32.StgCreateDocfileOnILockBytes",
    0x460818: "oledlg.OleUIInsertObjectA",
    0x46081C: "oledlg.OleUIConvertA",
    0x460820: "oledlg.OleUIEditLinksA",
    0x460824: "oledlg.OleUIBusyA",
    0x460828: "oledlg.OleUIAddVerbMenuA",
}

base = list(asm.keys())[0]
# print(base)


pie = 0x2270000


def rebase(addr):
    return addr - base + pie


try:
    eip = int(sys.argv[1], 16)
    if len(sys.argv) > 2:
        eip = eip - pie + base
except IndexError:
    eip = base

print(hex(eip), hex(max(asm.keys())))
counter = 0
cache = []
last = None
last_reg = None
while eip <= max(asm.keys()):
    if counter > 1000:
        quit()
    inst = asm[eip]
    if inst[1] == "jmp" and "0x" in inst[2]:
        eip = int(inst[2], 16)
        continue
    counter += 1
    if inst[1] == "call":
        last = None
        last_reg = None
        cache = []
        if "dword ptr [0x4" in inst[2]:
            k = inst[2].split("[")[-1][:-1]
            print(hex(rebase(eip)), inst[1], vtable[int(k, 16)])
        else:
            print(hex(rebase(eip)), ' '.join(inst[1:]))
    elif inst[1] == "mov" and "ptr" not in inst[2] and "0x" in inst[2] and "ebp" not in inst[2] and "esp" not in inst[2]:
        last_reg = inst[2].split(', ')[0]
        cache.append((eip, inst))
    elif len(cache) > 0 and inst[1] in ["xor", "sub", "add"] and "ptr" not in inst[2] and inst[2].split(', ')[0] == last_reg and "0x" in inst[2]:
        cache.append((eip, inst))
    else:
        if len(cache) > 0:
            op_str = cache.pop(0)[-1][-1].split(', ')
            reg = op_str[0]
            imm = int(op_str[1], 16)
            acc = imm
            for pc, i in cache:
                _op_str = i[-1].split(', ')
                _imm = int(_op_str[1], 16)
                if i[1] == "add":
                    acc += _imm
                elif i[1] == "sub":
                    acc -= _imm
                elif i[1] == "xor":
                    acc ^= _imm
                else:
                    raise NotImplementedError(i[1])
                acc = ctypes.c_uint32(acc).value
            print(f"{reg} = {acc:#x} ({ctypes.c_int32(acc).value:#x})")
            cache = []
            last_reg = None
        print(hex(rebase(eip)), ' '.join(inst[1:]))
    if inst[1] == "ret":
        quit()
    last = inst[1:]
    eip += inst[0]
